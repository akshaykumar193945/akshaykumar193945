<!DOCTYPE html>
<html>

<head>
    <title>School Admission</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iKl+uUZ+Kxh/c5Kx63uXtLl4i8/0p1uL7Q9DYgH5o/2n49t4mi4y9p1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='sty2.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head> 

<body>                
    <nav class="navbar navbar-expand-sm bg-dark py-3 px-4">
        <div class="container-fluid">
            <a class="navbar-brand text-white" href="{{ url_for('layout') }}">SSVM PUBLIC SCHOOL</a>
            <div class="navbar-nav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <!-- <li class="nav-item"><a class="nav-link active text-dark" aria-current="page" href="{{ url_for('layout') }}">Home</a></li> -->
                    <li class="nav-item"><a class = "nav-link text-white" id="load-user-credential" href="javascript:void(0)" onclick="loadUserCredential()">User Records</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="load-enrolled-courses" href="javascript:void(0)" onclick="showEnrolledCourse()">Enroll</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="load-contact-info" href="javascript:void(0)" onclick="showContact()">Contacts Info</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="load-course" href="javascript:void(0)" onclick="goToCourse()">Course</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="load-about" href="javascript:void(0)" onclick="loadAbout()">About</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="load-service" href="javascript:void(0)">Service</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="load-contact" href="javascript:void(0)">Contact</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="user-profile" href="javascript:void(0)" onclick="userProfile()">User Name</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="login-link" href="javascript:void(0)" onclick="loadLoginPage()">Login</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="signup-link" href="javascript:void(0)" onclick="signUp(event)">Signup</a></li>
                    <li class="nav-item"><a class = "nav-link text-white" id="logout-link" href="javascript:void(0)" onclick="confirmLogout()">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>
    {% block content %}
    
    <div id="content" class="content-container"></div>
    <div id="overlay"></div>

    <div id="floating-dialog">
        <div id="dialog-content"></div>
        <button onclick="closeDialog()">Close</button>
    </div>
    {% endblock %}
    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <img src="{{ url_for('static', filename='images.jpg') }}" alt="Company Logo">
            </div>
            <div class="footer-info">
                <p>&copy; 2023 Your Company Name</p>
                <p>Contact us: contact@yourcompany.com</p>
            </div>
            <div class="footer-contact-us">
                <p class="footer-p"> New Delhi  </p>
                <p class="footer-p"> Canaught Place </p>
                <p class="footer-p"> Phone : 471415836 </p>
                <p class="footer-p"> Email : dfvj@gmail.com </p>
            </div>
            <div class="footer-social">
                <a class="footer-links" href="#"><i class="fa fa-facebook"></i></a>
                <a class="footer-links" href="#"><i class="fa fa-twitter"></i></a>
                <a class="footer-links" href="#"><i class="fa fa-linkedin"></i></a>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-eed8dfL9W1jwyjjrZvy5VfvXH+L2FTRdflHb8nLlq+9GY5F86QCExl5fwgoyqxfH" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            loadHomeContent();
        });
    
        function loadHomeContent() {
            fetch('/home_content')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error fetching content:', error);
                    // Redirect to the error page
                    window.location.href = '/error';
                });
        };
    </script>
    
    <script>
        // Set the timeout duration (in milliseconds)
        const inactivityTimeout = 600000; // 5 minutes
      
        let logoutTimer;
      
        function resetLogoutTimer() {
          clearTimeout(logoutTimer);
          logoutTimer = setTimeout(logoutDueToInactivity, inactivityTimeout);
        }
      
        function logoutDueToInactivity() {
          // Redirect to the logout URL
          window.location.href = '/logout';
        }
      
        // Add event listeners to reset the timer on user activity
        document.addEventListener('mousemove', resetLogoutTimer);
        document.addEventListener('keypress', resetLogoutTimer);
      
        // Initial setup
        resetLogoutTimer();
      </script>
      
    <script>function validateForm() {
        var nameInput = document.getElementById("name");
        var nameError = document.getElementById("nameError");
        var name = nameInput.value.trim();
        var namePattern = /^[A-Za-z\s\-']+$/;
    
        var emailInput = document.getElementById("email");
        var emailError = document.getElementById("emailError");
        var email = emailInput.value.trim();
        var emailPattern = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/;
    
        var dobInput = document.getElementById("dob");
        var dobError = document.getElementById("dobError");
        var dob = dobInput.value.trim();
        // You can add date of birth validation here
    
        if (!namePattern.test(name)) {
            nameError.textContent = "Please enter a valid name.";
            return false;
        } else if (!emailPattern.test(email)) {
            emailError.textContent = "Please enter a valid email."
            return false;
        }
        
        else {
            nameError.textContent = "";
        }
    
        // Add similar validation for email and date of birth fields
    
        return true; // Allow form submission if all fields are valid
    }</script>

<script>
    // JavaScript to load "signup-link" section using AJAX
    // document.getElementById('signup-link').addEventListener('click', function(e) {
    function signUp(event){
        event.preventDefault(); // Prevent the default link behavior
        // Use AJAX to fetch the "signup" section content
		console.log("in signup in signup;");
        fetch('/signup')
            .then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "signup" content:', error);
            });
    };
</script>

    <script>
        // JavaScript to load "About" section using AJAX
        function loadAbout() {
            // e.preventDefault(); // Prevent the default link behavior
            // Use AJAX to fetch the "About" section content
            fetch('/about')
                .then(response => response.text())
                .then(data => {
                    // Insert the fetched content into the 'content' div
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading "About" content:', error);
                });
        };
    </script>

    <script>
        // JavaScript to load "service" section using AJAX
        document.getElementById('load-service').addEventListener('click', function(e) {
            e.preventDefault(); // Prevent the default link behavior
            // Use AJAX to fetch the "About" section content
            fetch('/service')
                .then(response => response.text())
                .then(data => {
                    // Insert the fetched content into the 'content' div
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading "service" content:', error);
                });
        });
    </script>

    <script>
        // JavaScript to load "contact" section using AJAX
        document.getElementById('load-contact').addEventListener('click', function(e) {
            e.preventDefault(); // Prevent the default link behavior
            // Use AJAX to fetch the "About" section content
            fetch('/contact')
                .then(response => response.text())
                .then(data => {
                    // Insert the fetched content into the 'content' div
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading "contact" content:', error);
                });
        });
    </script>

<script>
    // JavaScript to load "register" section using AJAX
    // document.getElementById('user-profile').addEventListener('click', 
    
    function userProfile() {

        // e.preventDefault(); // Prevent the default link behavior
        // Use AJAX to fetch the "About" section content
        fetch('/user_profile')
            .then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "find" content:', error);
            });
    };
</script>

<script>
    // JavaScript to load "user_credential" section using AJAX
    // document.getElementById('load-user-credential').addEventListener('click', function(e) {
    function loadUserCredential(){
		console.log("in user record ###########");
        fetch('/user_records')
            .then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
				console.log("in user_records");
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "find" content:', error);
            });
    };

    function updateUserRecord(recordId) {
        if (confirm('Are you sure you want to update this record?')) {
            fetch(`/update_user_record/${recordId}`)
                .then(response => response.text())
                .then(data => {
                    // Insert the fetched content into the 'content' div
					console.log("in edit user record ");
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading "find" content:', error);
                });
        }
    };

    function submitUpdateUserData(recordId) {
        event.preventDefault();
        if (validateUserForm()) {
            var formData = {
                first_name: document.getElementById('first_name').value,
                last_name: document.getElementById('last_name').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                mobile_number: document.getElementById('mobile_number').value,
            };
            if (confirm('Are you sure you want to update this record ??')) {
                event.preventDefault();
                console.log('in record user edited');
                fetch(`/record_user_edited/${recordId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json', // Set the Content-Type header
                    },
                    body: JSON.stringify(formData),
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to update record');
                    }
                })
                .then(data => {
                    console.log(data.message);
                    if (data.user_record) {
                        // document.getElementById('content').innerHTML = `Updated User Record: ${JSON.stringify(data.user_record)}`;
                        myDialog(`Updated User Record: ${JSON.stringify(data.user_record)}`, function() {loadUserCredential();});                        
                    } else {
                        console.log('No updated record information provided');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        }
        return false;
    };

    function validateUserForm(){
        // add your form validation here
    return true;
    }

    function deleteUserRecord(recordId) {
        if (confirm('Are you sure you want to delete this record?')) {
            fetch(`/delete_user_record/${recordId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to delete record');
                }
            })
            .then(data => {
                // Handle successful deletion, e.g., update UI or show a message
                console.log(data.message);
                if (data.deleted_record) {
                    // document.getElementById('content').innerHTML = `Deleted Record: ${JSON.stringify(data.deleted_record)}`;
                    myDialog(`Deleted Record: ${JSON.stringify(data.deleted_record)}`, function () {loadUserCredential();});
                    // loadUserCredential();
                } else {
                    // Handle the case where no deleted record information is returned
                    console.log('No deleted record information provided');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    };
</script>

<script>
	var directedFunct;
    function showFloatingDialog(message) {
        var dialog = document.getElementById('floating-dialog');
        var content = document.getElementById('dialog-content');
        content.innerHTML = message;
        dialog.style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
    }

    function closeDialog() {
        var dialog = document.getElementById('floating-dialog');
        dialog.style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
        // Restore scrolling when the overlay is closed
        document.body.style.overflow = 'auto';
		directedFunct();
    }

    // Simulate a server response
    function myDialog(serverResponse, callBack) {
        // Use setTimeout to simulate a delay before showing the dialog
        setTimeout(function () {
            console.log(serverResponse); // Log the server response to the console
            showFloatingDialog(serverResponse); // Show the floating dialog with the server response
            // Disable scrolling when the overlay is active
            document.body.style.overflow = 'hidden';
			directedFunct = callBack;
        }, 500);  // Simulating a delay of .5 seconds
    }
</script>

<script>
    function logIn(event){
        event.preventDefault(); // Prevent the default form submission
		console.log("in login-form iiiiiiiiiiiiiiin login-form");
        // Get form data
        const formData = new FormData(event.target);
		console.log("in login-form iin login-form");
        document.getElementById('password').addEventListener('focus', function () {
            document.getElementById('password_error').innerHTML = '';
        });

        // Send login request using Fetch API
        fetch('{{ url_for('login') }}', {
            method: 'POST',
            body: formData,
        }).then(response =>response.json())
            .then(data => {
				if (data.status == true) {
            // Redirect or handle success as needed
					window.location.href = data.redirect;
				} else if(data.message === 'Incorrect Password !'){
                    document.getElementById('password_error').innerHTML = data.message;
                    document.getElementById('password_error').style.color = 'red';
                } else {
                    // Handle login failure
                    console.error(data.message);
					const shouldSignUp = window.confirm('Invalid credentials. Please check your username and password or sign in for new account.');     
                    // Fetch and render the signup template in the content area
                    if (shouldSignUp) {
                    // Fetch and render the signup template in the content area
                    signUp(event);
                    }
                }
            })
        .catch(error => {
            console.error('Error during login:', error);
        });
    };
</script>

<script>
	function showEnrolledCourse(){
		
		fetch('/show_enrolled_course').then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
				console.log("in cources !!!!!!!!");
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "find" content:', error);
            });
	};

    function updateUserOrder(recordId){
        if (confirm('Are you sure you want to update this record?')) {
            fetch(`/edit_user_order/${recordId}`)
                .then(response => response.text())
                .then(data => {
                    // Insert the fetched content into the 'content' div
					console.log("in edit user record ");
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading "find" content:', error);
                });
        }
    };

    function submitUpdateUserOrder(recordId) {
       event.preventDefault();
       if (validateUserForm()) {
           var formData = {
               course: document.getElementById('course').value,
               course_id: document.getElementById('course_id').value,
           };
           if (confirm('Are you sure you want to update this record ??')) {
               event.preventDefault();
               console.log('in edit user order');
               fetch(`/submit_edit_order/${recordId}`, {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json', // Set the Content-Type header
                   },
                   body: JSON.stringify(formData),
               })
               .then(response => {
                   if (response.ok) {
                       return response.json();
                   } else {
                       throw new Error('Failed to update order');
                   }
               })
               .then(data => {
                   console.log(data.message);
                   if (data.user_order) {
                    //    document.getElementById('content').innerHTML = `Updated User order: ${JSON.stringify(data.user_order)}`;
                       myDialog(`Updated User order: ${JSON.stringify(data.user_order)}`, function(){showEnrolledCourse();});
                       
                   } else {
                       console.log('No updated order information provided');
                   }
               })
               .catch(error => {
                   console.error('Error:', error);
               });
           }
       }
       return false;
   };
   
   function validateUserForm(){
       // add your form validation here
   return true;
   }

    function deleteUserOrder(recordId) {
        if (confirm('Are you sure you want to delete this order?')) {
            fetch(`/delete_user_order/${recordId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to delete record');
                }
            })
            .then(data => {
                // Handle successful deletion, e.g., update UI or show a message
                console.log(data.message);
                if (data.deleted_record) {
                    // document.getElementById('content').innerHTML = `Deleted Order: ${JSON.stringify(data.deleted_record)}`;
                    myDialog(`Deleted Order: ${JSON.stringify(data.deleted_record)}`, function () {showEnrolledCourse();});
                    // showEnrolledCourse();
                } else {
                    // Handle the case where no deleted record information is returned
                    console.log('No deleted record information provided');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    }

</script>

<!-- Move this script block to the head or before any other script that uses these functions -->
<script>
    function checkLoginStatus() {
        var load_user_tab = document.getElementById('load-user-credential');
        var load_enroll_tab = document.getElementById('load-enrolled-courses');
        var loginLink = document.getElementById('login-link');
        var logoutLink = document.getElementById('logout-link');
        var signupLink = document.getElementById('signup-link');
        var username = document.getElementById('user-profile');
        var contactInfo = document.getElementById('load-contact-info');
        var contact = document.getElementById('load-contact');

        function removeElement(element) {
            if (element && element.parentNode) {
                element.parentNode.removeChild(element);
            }
        }

        fetch('/check_login_status')
            .then(response => response.json())
            .then(data => {
                if (data.authenticated) {
                    load_user_tab.innerHTML = 'User Records';
                    load_enroll_tab.innerHTML = 'Enroll';                    
                    removeElement(loginLink);
                    removeElement(signupLink);
                    removeElement(contact);
                    logoutLink.innerHTML = 'Logout';
                    username.innerHTML = data.username;
                } else {
                    loginLink.innerHTML = 'Login';
                    signupLink.innerHTML = 'Signup';
                    removeElement(load_user_tab);
                    removeElement(load_enroll_tab);
                    removeElement(logoutLink);
                    removeElement(username);
                    removeElement(contactInfo);
                }
            })
            .catch(error => {
                console.error('Error checking login status:', error);
            });
    }

    // Call the function when the page loads
    document.addEventListener('DOMContentLoaded', checkLoginStatus);
</script>

<script>
    function confirmLogout() {
        if (confirm("Are you sure you want to logout?")) {
            // Redirect to the logout URL
            window.location.href = "{{ url_for('logout') }}";
            document.addEventListener('DOMContentLoaded', checkLoginStatus);
        }
    }

    function loadLoginPage() {
        fetch('/login')
            .then(response => response.text())  // Parse the response as text
            .then(data => {
                // Update the content area with the fetched login form
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error fetching login form: ', error);
            });
    }
</script>

<script>
    function loadSignedIn() {
        event.preventDefault();
        // Get the form data
        const formData = new FormData(document.querySelector('.signup-form'));
		
        // Create an object from the form data
        const formDataObject = {};
        formData.forEach((value, key) => {
            formDataObject[key] = value;
        });

        // Convert the object to a JSON string
        const jsonData = JSON.stringify(formDataObject);
		console.log("in submiting signup form");
        // Make a POST request to the /logged_in endpoint with the form data
        fetch('/signup', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: jsonData,
        })
            .then(response => response.json())
            .then(data => {
                console.log(`Record: ${JSON.stringify(data)}`);
                if (data.status) {
                    console.log(data.message);
					alert(`${JSON.stringify(data.message)}`)
                    loadLoginPage();
                } else {
                    console.log(`${JSON.stringify(data.message)}`);
                    alert(`${JSON.stringify(data.message)}`);
                    alert('Redirecting to Login')
                    loadLoginPage();
                }
            }).catch(error => {
			console.log("in error in error in error");
                console.error('Error fetching login form: ', error);
            });
    }

    // Function to load the login-link content
    // function loadLoginLink() {
    //     fetch('/login')  // Assuming 'login' is the route to fetch login-link content
    //         .then(response => response.text())
    //         .then(data => {
    //             // Update the login-link area with the fetched login-link content
    //             document.getElementById('content').innerHTML = data;
    //         })
    //         .catch(error => {
    //             console.error('Error fetching login-link content: ', error);
    //         });
    // }
</script>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function performTableSearch() {
        var searchTerm = document.getElementById('tableSearchInput').value.toLowerCase();
        var tableRows = document.querySelectorAll('.table tbody tr');
        console.log("In Table searches ")

        tableRows.forEach(function (row) {
            var rowText = row.textContent.toLowerCase();
            var isVisible = rowText.includes(searchTerm);
            row.style.display = isVisible ? 'table-row' : 'none';
        });
    }
</script>

<script>
    function deleteRecord(recordId) {
    if (confirm('Are you sure you want to delete this record?')) {
        fetch(`/delete_record/${recordId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                throw new Error('Failed to delete record');
            }
        })
        .then(data => {
            // Handle successful deletion, e.g., update UI or show a message
            console.log(data.message);
            if (data.deleted_record) {
                // document.getElementById('content').innerHTML = `Deleted Record: ${JSON.stringify(data.deleted_record)}`;
                myDialog(`Deleted Record: ${JSON.stringify(data.deleted_record)}`);
            } else {
                // Handle the case where no deleted record information is returned
                console.log('No deleted record information provided');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
}
</script>

<script>
    function updateRecord(recordId) {
        if (confirm('Are you sure you want to update this record?')) {
            fetch(`/update_record/${recordId}`)
                .then(response => response.text())
                .then(data => {
                    // Insert the fetched content into the 'content' div
					console.log("in edit user record ");
                    document.getElementById('content').innerHTML = data;
                })
                .catch(error => {
                    console.error('Error loading "find" content:', error);
                });
        }
    };
</script>

<script>
    // record edited
    function submitRegistrationForm(recordId) {
    // Collect form data or create your data object
    if (validateForm()){
        var formData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            dob: document.getElementById('dob').value
            // Add more fields as needed
        };
        event.preventDefault();
        if (confirm('Are you sure you want to update this record ??')) {
            console.log('in record edited');
            fetch(`/record_edited/${recordId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData), // Convert data to JSON
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to update record');
                }
            })
            .then(data => {
                console.log(data.message);
                if (data.admission_record) {
                    // document.getElementById('content').innerHTML = `Updated Record: ${JSON.stringify(data.admission_record)}`;
                    myDialog(`Updated Record: ${JSON.stringify(data.admission_record)}`, function(){loadUserCredential();});
                    // loadUserCredential();
                } else {
                    // Handle the case where no deleted record information is returned
                    console.log('No deleted record information provided');
                }
            })
            .catch(error => {
                console.log("in error")
                console.error('Error:', error);
            });
        }}
        return False;
}
</script>

<script>
    function downloadExcel(tableName) {
        if (confirm('Are you sure you want to download Excel?')) {
            console.log(tableName);
            fetch('/process_form', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ tableName: tableName }),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    }

</script>

<script>
    function goToCourse(){
        console.log("i am in course page ")
        fetch('/courses')
            .then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "find" content:', error);
            });
    };
</script>

<script>
    function forgetPassword(){

        fetch('/forgot_password').then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "find" content:', error);
            });
    };

    function submitPwdRecoveryForm(event) {
        event.preventDefault();
        var username = document.getElementById('username').value;
        console.log("inside password recovery : ", username, " ::::: ");
        fetch(`/update_password_1/${username}`)
            .then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "update_password" content:', error);
            });
    };

    function submitUpdatedPwd(username) {
        event.preventDefault();
        console.log("in in in in in in in ");

        // Create the line break element
        var lineBreak = document.createElement("br");

        // "Iterate over the form data of class='new-pwd-form' "
        const formData = new FormData(document.querySelector('.new-pwd-form'));
        const formDataObject = {};
        formData.forEach((value, key) => {
            formDataObject[key] = value;
        });

        var newPasswordInput = document.getElementById('new_password');
        var newPasswordError = document.getElementById('newPasswordError');
        var confirmNewPassword = document.getElementById('confirmNewPassword');
        var oneBreakContainer = document.getElementById('oneBreak');
        var oneBreak_1_Container = document.getElementById('oneBreak_1');
        

        var confirmPasswordInputError = document.getElementById('confirmNewPasswordError');

        // Event listener to clear the error message and remove the line break
        newPasswordInput.addEventListener('focus', function () {
            newPasswordError.innerHTML = '';
            // console.log("hjhjhjhjhjhh");
            if (oneBreakContainer.contains(lineBreak)) {
                oneBreakContainer.removeChild(lineBreak);
                console.log("hjhjhjhjhjhh");
            }
        });
        
        confirmNewPassword.addEventListener('focus', function () {
            confirmNewPasswordError.innerHTML = '';
            // console.log("hjhjhjhjhjhh");
            if (oneBreak_1_Container.contains(lineBreak)) {
                oneBreak_1_Container.removeChild(lineBreak);
                console.log("hjhjhjhjhjhh");
            }
        });        
        
        console.log(newPasswordInput.value, confirmNewPassword.value);
        fetch(`/password_updated/${username}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formDataObject),
        })
        .then(response => response.json())
        .then(data => {
            console.log('7777777777777777777');
            console.log(data.status);
            if (data.status == true && data.status !== '1') {
                console.log(data.message);
                // document.getElementById('content').innerHTML = `Password Updated: ${JSON.stringify(data.user_password)}`;
                // Other actions you want to perform on success
                myDialog(`Password Updated: ${JSON.stringify(data.user_password)} Succesfully`, function () {loadLoginPage();});

                // loadLoginPage();
            } else if (data.status === '1') {
                console.warn(data.message);
                confirmPasswordInputError.innerHTML = data.message;
                oneBreak_1_Container.appendChild(lineBreak);
            } else {
                console.error(data.message);
                newPasswordError.innerHTML = data.message;
                oneBreakContainer.appendChild(lineBreak);
            }
        })
        .catch(error => {
            console.error('Error loading "update_password" content:', error);
        });
    };
</script>

<script>
    function enrollCourse(event, course, course_id) {
        event.preventDefault(); // Prevent the default link behavior

        // Use fetch to check login status
        fetch('/check_login_status')
            .then(response => response.json())
            .then(data => {
                // Check if the user is authenticated
                console.log("In enroll courses !!! ");
                if (data.authenticated) {
                    // If authenticated, proceed to fetch and load course content
                    fetch(`/enroll_Course`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ course_name : course, course_id : course_id }), // Include the selected course data
                    })
                    .then(response => response.text())
                    .then(courseData => {
                        // Insert the fetched content into the 'content' div
                        //document.getElementById('content').innerHTML = courseData;
                        console.log(courseData);
                        myDialog(`Enrolled successful: ${JSON.stringify(courseData.message)}`, function () { userProfile();});
                    })
                    .catch(courseError => {
                        console.error('Error loading "enroll Course" content:', courseError);
                    });
                } else {
                    // If not authenticated, redirect to the login page
                    console.log("not authenticated ");
                    alert("Please login to Enroll in your cource ");
                    document.getElementById('content').innerHTML = loadLoginPage()
                }
            })
            .catch(error => {
                console.error('Error checking login status:', error);
            });
    };

</script>

<script>
    function showContact(){
        fetch(`/contact_records`)
            .then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
				console.log("in contact_records");
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "find" content:', error);
                }
            );
    };

    function onContactSubmit(event) {
        event.preventDefault();
        const formData = new FormData(document.querySelector('#contactForm'));

        // Create an object from the form data
        const formDataObject = {};
        formData.forEach((value, key) => {
            formDataObject[key] = value;
        });

        // Convert the object to a JSON string
        const jsonData = JSON.stringify(formDataObject);
        console.log(jsonData)
        console.log("Submitting contact form");

        // Replace 'YOUR_API_ENDPOINT' with your actual API endpoint
        fetch(`/contact_submission`, {
            method: 'POST', // or 'PUT', 'DELETE', etc.
            headers: {
                'Content-Type': 'application/json',
                // Add any other headers you may need, e.g., authorization headers
            },
            body: jsonData,
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json(); // Parse the JSON from the response
        })
        .then(data => {
            console.log('Server response:', data);
            myDialog(`${JSON.stringify(data.message)}`, function () { loadLoginPage();});
        })
        .catch(error => {
            console.error('Error during fetch operation:', error);
        });
    }

    function updateContactRecord(contactId){
        if (confirm('Are you sure you want to Update this Contact?')) {
            console.log("in update contact form");
            console.log(contactId);

            var contactId = {
                contactId: contactId,
            };
            var jsonString = JSON.stringify(contactId);
            console.log(jsonString);
            fetch(`/update_contact`,  {
                method: 'POST',            
                headers: {
                    'Content-Type': 'application/json',
                },
                body: jsonString,
            })            
            .then(response => response.text())
            .then(data => {
                // Insert the fetched content into the 'content' div
				console.log("in contact_records");
                document.getElementById('content').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading "find" content:', error);
                }
            );
        }
    }

    function submitUpdateContact(contactId) {
        event.preventDefault();
        if (confirm('Are you sure you want to Delete this Contact?')) {
            const formData = new FormData(document.querySelector('.update-contact-form'));
            const formDataObject = {};
            formData.forEach((value, key) => {
                formDataObject[key] = value;
            });

            formDataObject['contactId'] = contactId;
            // console.log(formDataObject['contactId'] );

            // Convert the object to a JSON string
            const jsonData = JSON.stringify(formDataObject);
            
            fetch(`/execute_update_contact`,  {
                method: 'POST',            
                headers: {
                    'Content-Type': 'application/json',
                },
                body: jsonData,
            })            
            .then(response => response.json())
            .then(data => {
                if (data.status){
                    console.log("in execute contact_records");
                    console.log(data.message);
                    myDialog(`${JSON.stringify(data.message)} Updated`, function () {showContact();});
                }
                else{
                    console.log(data.message);
                    myDialog(`${JSON.stringify(data.message)}`, function () {showContact();});
                }
            })
            .catch(error => {
                console.error('Error loading content:', error);
                console.log(data.message);
                }
            )
        }
    }

    function deleteContactRecord(contactId){
        if (confirm('Are you sure you want to Delete this Contact?')) {
            console.log("in delete delete");
            console.log(contactId);

            var contactId = {
                contactId: contactId,
            };

            // Convert the JavaScript object to a JSON string
            var jsonString = JSON.stringify(contactId);

            // Output the JSON string
            console.log(jsonString);
            fetch(`/delete_contact`,  {
                method: 'POST',            
                headers: {
                    'Content-Type': 'application/json',
                },
                body: jsonString,
            })
            .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to delete record');
                    }
                })
                .then(data => {
                    // Handle successful deletion, e.g., update UI or show a message
                    console.log(data.message);
                    if (data.deleted_contact) {
                        // document.getElementById('content').innerHTML = `Deleted Record: ${JSON.stringify(data.deleted_record)}`;
                        myDialog(`Deleted Record: ${JSON.stringify(data.deleted_contact)}`, function () {showContact();});
                        // loadUserCredential();
                    } else {
                        // Handle the case where no deleted record information is returned
                        console.log('No deleted record information provided'+ (data.error ?? ''));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    }

</script>

</body>

</html>